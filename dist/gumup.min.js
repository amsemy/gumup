// Gumup
// version: 0.2.2
// author: Amsemy <amsemy@gmail.com>
// license: MIT

(function(){function a(a){return a&&n.test(a)}function b(a){return a&&m.test(a)}function c(a){var b=new Error(a);throw b.name="GumupError",b}function d(a,b,d){var e;if("*"===b)for(e in a)d.call(this,e);else if("*"===b.charAt(b.length-1)){var f=b.substring(0,b.length-1);for(e in a)0===e.indexOf(f)&&d.call(this,e)}else a[b]?d.call(this,b):c("Invalid dependency '"+b+"'")}function e(a,b){if(""!==b)for(var d=b.split("."),e="",f=0,g=d.length;g>f;f++){var h=d[f];e+=h,null==a[h]?a[h]={}:"object"!=typeof a[h]&&c("Cann't init unit '"+b+"' because path element '"+e+"' isn't an object"),a=a[h],e+="."}return a}function f(a){return"[object Array]"===Object.prototype.toString.call(a)}function g(a,d){var e=d.injections;f(e)||c("Invalid injections array in inject settings");for(var g=a._declarations,h=0,i=e.length;i>h;h++){var j=e[h];"object"!=typeof j&&c("Invalid injection ["+h+"] in inject settings");var k=j.name;if(b(k)||c("Invalid injection name '"+k+"' ["+h+"] in inject settings"),null!=j.unit&&void 0!==j.value&&c("Unit and value can't be used together ["+h+"] in inject settings"),null!=j.unit){d.namespace instanceof p||c("Invalid namespace in inject settings");var l=j.unit;b(l)||c("Invalid unit name '"+l+"' ["+h+"] in inject settings");var m=d.namespace._declarations;null==m[l]&&c("Unresolvable unit declaration '"+l+"' ["+h+"] in inject settigs"),g[k]=m[l]}else void 0!==j.value?g[k]=new o(function(a){return function(){return a}}(j.value)):c("Invalid injection object ["+h+"] in inject settings")}}function h(a,b,e,f,g){var i=a[e];if(!f[e]){g[e]&&c("Recursive dependency '"+e+"'"),g[e]=!0;for(var j=0,k=i._dependencies.length;k>j;j++){var l=i._dependencies[j];d(a,l,function(c){c!==e&&h(a,b,c,f,g)})}b[e]=i,f[e]=!0}}function i(b,e){var g=e.units;f(g)||c("Invalid units array in pick settings"),e.namespace instanceof p||c("Invalid namespace in pick settings");for(var i={},j=e.namespace._declarations,k=0,l=g.length;l>k;k++){var m=g[k];a(m)||c("Invalid unit name '"+m+"' in pick settings"),d(j,m,function(a){h(j,b._declarations,a,i,{})})}}function j(){c("Gumup namespace has already been initialized")}function k(a,b,c,d,e){var f=b[c];if(!e[c]){for(var g=d.dependencies[c].length,h=0;g>h;h++)k(a,b,d.dependencies[c][h],d,e);f._init(a,c),e[c]=!0}}function l(a,b,e,f,g){var h=a[b];if(!f[b]){g[b]&&c("Recursive dependency '"+b+"'"),g[b]=!0;for(var i=0,j=h._dependencies.length;j>i;i++){var k=h._dependencies[i];d(a,k,function(c){c!==b&&(delete e.root[c],e.dependencies[b].push(c),l(a,c,e,f,g))})}f[b]=!0}}var m=/^(?:[A-Za-z_\$][\w\$]*(?:\.[A-Za-z_\$][\w\$]*)*)$/,n=/^(?:[A-Za-z_\$][\w\$]*(?:\.[A-Za-z_\$][\w\$]*)*(?:\.\*)?|\*)$/,o=function(a){this._dependencies=[],this._implementation=a};o.prototype.require=function(b){return a(b)||c("Invalid require name '"+b+"'"),this._dependencies.push(b),this},o.prototype._init=function(a,b){var d=b.lastIndexOf("."),f=d>=0?b.substring(0,d):"",g=d>=0?b.substring(d+1):b,h=e(a.units,f),i=h[g];null==i?i={}:"object"!=typeof i&&c("Cann't create unit '"+b+"' because there is an object on this path"),h[g]=this._implementation.call(i,a.units),null==h[g]&&(h[g]=i)};var p=function(){this._declarations={},this.units={}};p.prototype.constructor=p,p.prototype.init=function(){this.init=j,this.unit=j;var a,b={dependencies:{},root:{}},c={},d={};for(a in this._declarations)this._declarations[a].require=j,b.dependencies[a]=[],b.root[a]=!0;for(a in this._declarations)l(this._declarations,a,b,c,{});for(a in b.root)k(this,this._declarations,a,b,d)},p.prototype.inject=function(a){return g(this,a),this},p.prototype.pick=function(a){return i(this,a),this},p.prototype.unit=function(a,d){return b(a)||c("Invalid unit name '"+a+"'"),"function"!=typeof d&&c("Invalid implementation of '"+a+"' unit"),this._declarations[a]?new o(d):this._declarations[a]=new o(d)},this.gumup=new p}).call(this);
//# sourceMappingURL=gumup.min.map