// Namespace.js
// version: 1.0.1
// author: Amsemy
// license: MIT
(function(){function a(a){return null!=a&&l.test(a)}function b(a){return null!=a&&m.test(a)}function c(a){var b=new Error(a);return b.name="NamespaceError",b}function d(a,b,d){function e(a){for(var b="",c=0;a>c;c++)b+=f[c]+(a>c+1?".":"");return b}for(var f=b.split("."),g=0,h=f.length;h>g;g++){var i=f[g],j=a[i];if(g+1==h){if(null==j)j=null==d?{}:d,a[i]=j;else if(null!=d||"object"!=typeof j)throw c("Cann't init module '"+b+"' because there is an object on this path");return j}if(null!=j&&"object"!=typeof j)throw c("Cann't init module '"+b+"' because path element '"+e(g)+"' isn't an object");a[i]=null==j?{}:j,a=a[i]}}function e(a,b,d){if("*"===b)for(var e in a)d.call(this,e);else if("*"===b.charAt(b.length-1)){var f=b.substring(0,b.length-1);for(var e in a)0===e.indexOf(f)&&d.call(this,e)}else{if(null==a[b])throw c("Invalid dependency '"+b+"'");d.call(this,b)}}function f(b,d){var e=null==d.dependencies?[]:d.dependencies;if("[object Array]"!==Object.prototype.toString.call(e))throw c("Invalid dependencies array in import settings");for(var f=null,g=b._declarations,h=e.length,i=0;h>i;i++){var j=e[i];if("object"!=typeof j)throw c("Invalid dependencies in import settings");if(!a(j.name))throw c("Invalid dependency name '"+j.name+"' in import settings");var k=j.name;if("string"==typeof j.implementation){if(null==f){if(!(d.namespace instanceof n))throw c("Invalid namespace in import settings");f=d.namespace._declarations}if(!a(j.implementation))throw c("Invalid dependency implementation'"+j.implementation+"'");var l=j.implementation;if(null==f[l])throw c("Invalid dependency '"+l+"'");g[k]=f[l]}else{var m=new b.Declaration(function(a){return function(){return a}}(j.implementation));m._isObject=!0,g[k]=m}}}function g(a,b,d,f,h){e(a,d,function(d){if(f[d]!==!0){if(h[d]===!0)throw c("Recursive dependency '"+d+"'");h[d]=!0;for(var e=a[d],i=e._dependencies.length,j=0;i>j;j++){var k=e._dependencies[j];g(a,b,k,f,h)}b[d]=e,f[d]=!0}})}function h(a,d){var e=null==d.modules?[]:d.modules;if("[object Array]"!==Object.prototype.toString.call(e))throw c("Invalid modules array in import settings");var f=e.length;if(f>0){if(!(d.namespace instanceof n))throw c("Invalid namespace in import settings");for(var h={},i=d.namespace._declarations,j=a._declarations,k=0;f>k;k++){var l=e[k];if(!b(l))throw c("Invalid module name '"+l+"' in import settings");g(i,j,l,h,{})}}}function i(){throw c("Namespace has already been inited")}function j(a,b,c,e){var f=b[c];if(e.inited[c]!==!0){for(var g=f._dependenciesUncapped.length,h=0;g>h;h++)j(a,b,f._dependenciesUncapped[h],e);var i;f._isObject===!0?(i=f._implementation(a.modules),d(a.modules,c,i)):(i=d(a.modules,c),f._implementation.call(i,a.modules)),e.inited[c]=!0}}function k(a,b,d,f){var g=a[b];if(d.resolved[b]!==!0){if(f[b]===!0)throw c("Recursive dependency '"+b+"'");f[b]=!0,g._dependenciesUncapped=[];for(var h=g._dependencies.length,i=0;h>i;i++){var j=g._dependencies[i];e(a,j,function(c){c!==b&&(delete d.root[c],g._dependenciesUncapped.push(c),k(a,c,d,f))})}d.resolved[b]=!0}}var l=/^(?:[A-Za-z_\$][\w\$]*(?:\.[A-Za-z_\$][\w\$]*)*)$/,m=/^(?:[A-Za-z_\$][\w\$]*(?:\.[A-Za-z_\$][\w\$]*)*(?:\.\*)?|\*)$/,n=function(){var a=this.Declaration=function(a){this._dependencies=[],this._dependenciesUncapped=null,this._implementation=a};a.prototype.require=function(a){if(!b(a))throw c("Invalid require name '"+a+"'");return this._dependencies.push(a),this},this._declarations={},this.modules={}};n.prototype.constructor=n,n.prototype.import=function(a){return h(this,a),f(this,a),this},n.prototype.init=function(){var a={inited:{},resolved:{},root:{}};this.Declaration.prototype.require=i,this.init=i,this.module=i;for(var b in this._declarations)a.root[b]=!0;for(var b in this._declarations)k(this._declarations,b,a,{});for(var b in a.root)j(this,this._declarations,b,a)},n.prototype.module=function(b,d){if(!a(b))throw c("Invalid module name '"+b+"'");if("function"!=typeof d)throw c("Invalid implementation of '"+b+"' module");if(null==this._declarations[b]){var e=new this.Declaration(d);return this._declarations[b]=e,e}throw c("Module '"+b+"' has already been declared")},n.prototype.object=function(a,b){var c=this.module(a,b);return c._isObject=!0,c},this.namespace=new n}).call(this);